# منصة الصرافة - مكتب صرافة رقمي

## Overview
منصة ويب متقدمة لتبادل العملات والتواصل في السوق الليبي، تركز على الرسائل الخاصة متعددة اللغات القوية والميزات التفاعلية. تهدف المنصة إلى توفير سوق رقمي آمن وفعال لتبادل العملات، مع رؤية لتبسيط العمليات المالية وتوفير تجربة مستخدم سلسة في بيئة آمنة وشفافة. تشمل قدراتها الأساسية التواصل الفوري، إدارة التحويلات الداخلية والدولية، وتتبع دقيق للعمولات والأرصدة.

## Recent Progress - Mobile Optimization
### ✅ Mobile Responsiveness Implementation (January 2025)
- **صفحة طلب تفعيل التحويل الخارجي**: ✅ **مكتمل بالكامل** - تحسين شامل للهاتف المحمول مع ضغط عدواني للنصوص (text-[10px] على الموبايل) وتصغير العناصر (h-6 بدلاً من h-8).
- **صفحة إدارة المكاتب**: ✅ **مكتمل بالكامل** - تم تطبيق الضغط العدواني على جميع الأجزاء:
  - الحاوي الرئيسي والعناوين والتبويب
  - إعدادات العمولة (النماذج والبطاقات والمدخلات)
  - عرض العمولات الحالية والإحصائيات
  - تبويب التحويلات بين المكاتب (النماذج وملخص التكاليف)
  - الأرصدة والمكاتب المعتمدة
  - سجل التحويلات (الجدول والأزرار والبادجات)
  - نماذج الإرسال الدولي مع كافة الحقول والتحديدات
- **إصلاحات زر المزيد في المحادثات**: ✅ **مكتمل بالكامل** - حل مشكلة عدم عمل زر المزيد:
  - تحسين حجم منطقة النقر (min-w-[28px] min-h-[28px] مع padding)
  - إصلاح تضارب event listeners باستخدام capture phase وsetTimeout
  - إضافة data attributes للتتبع الأفضل (data-more-button، data-testid)
  - تحسين تأثيرات بصرية (hover effects، rounded corners، transitions)
  - إضافة stopPropagation لمنع التضارب مع النقرات الأخرى
- **معايير التحسين المطبقة بثبات**:
  - ضغط الحشو من px-6 إلى px-1 sm:px-6
  - تصغير النصوص من text-sm إلى text-[10px] sm:text-sm  
  - تقليل ارتفاع العناصر من h-10 إلى h-6 sm:h-10
  - ضغط المسافات بين العناصر من space-y-6 إلى space-y-2 sm:space-y-6
  - تحسين الأيقونات إلى h-3 w-3 sm:h-5 sm:w-5
  - تحسين الأزرار والبادجات والجداول للهاتف المحمول

## User Preferences
- **اللغة**: العربية مع تخطيط RTL
- **الأرقام**: استخدام الأرقام العربية الغربية (0-9) بدلاً من الشرقية (٠-٩)
- **واجهة المستخدم**: تصميم نظيف ومتجاوب مع تركيز على سهولة الاستخدام
- **الأمان**: نظام مصادقة قوي مع إدارة أذونات متقدمة

## System Architecture

### UI/UX Decisions
- تصميم نظيف ومتجاوب يدعم تخطيط RTL للغة العربية.
- استخدام Tailwind CSS و shadcn/ui لتصميم الواجهة الأمامية.
- تمييز بصري واضح بين الرسائل المرسلة والمستقبلة في المحادثات.
- استخدام مربعات ملونة لتوضيح التفاصيل المالية في ملخص التكاليف.
- عرض أرقام الحسابات والأرقام الأخرى بالأرقام العربية الغربية (0-9).

### Technical Implementations
- **نظام المصادقة والأمان**: استخدام JWT tokens مع تشفير bcrypt لكلمات المرور، أرقام حسابات متسلسلة وفريدة، نظام بصمات الأجهزة، تتبع محاولات تسجيل الدخول الفاشلة، وحظر الأجهزة تلقائياً. يتضمن نظام التقاط صور أمنية تلقائي عند نشاط مشبوه، ونظام إدارة سجلات أمنية متقدمة. **نظام التوثيق التلقائي**: عند الموافقة على طلب توثيق الوكيل، يتم إنشاء مكتب له تلقائياً في جدول agent_offices بكود مكتب فريد (AGT + رقم المستخدم).
- **نظام العملات والعمولات**: دعم عملات متعددة (LYD, USD, EUR, TRY, AED, EGP, TND, GBP) مع عمولات نظام قابلة للتخصيص بناءً على الشرائح (نسبة مئوية، نسبة في الألف، قيمة ثابتة). يتضمن نظام حساب تجميع للعمولات وإدارة إعدادات استقبال الحوالات.
- **نظام المحادثات**: محادثات خاصة (1-إلى-1)، جماعية، وعامة مع دعم المرفقات، التحرير، الحذف الفردي، وتتبع الرسائل غير المقروءة، ومؤشرات الكتابة. يشمل نظام رسائل صوتية شاملة (تسجيل، تشغيل، نسخ نصي، بحث). **نظام إعادة التوجيه المتقدم**: إعادة توجيه الرسائل بأسلوب WhatsApp/Viber مع مؤشرات بصرية "🔄 إعادة توجيه من [اسم المرسل]"، مصادقة WebSocket مع JWT، وحماية شاملة ضد انتحال الهوية وتزوير البيانات.
- **نظام الواجهة المتكيفة**: نظام تبديل الواجهة المظلمة/الفاتحة قابل للتخصيص مع حفظ تفضيلات المستخدم وتطبيق شامل على جميع المكونات.
- **نظام PWA (Progressive Web App)**: تطبيق ويب تقدمي مع إمكانية التثبيت كتطبيق هاتف، Service Worker للعمل بدون إنترنت، وشريط تثبيت تفاعلي مع دعم كامل لنظامي Android و iOS.
- **نظام التحويلات**: تحويلات داخلية بين المستخدمين باستخدام أرقام حسابات متسلسلة، وتحويلات بين المكاتب (المحلية والدولية) مع رموز تحقق.
- **لوحة الإدارة المتقدمة**: إدارة شاملة للمستخدمين، مراقبة التحويلات، نظام طلبات الترقية والتحقق من الوثائق، وإدارة الأرصدة والدول ومكاتب الوكلاء، بالإضافة إلى لوحة الأمان المتخصصة.
- **الإيصالات الرقمية والحرارية**: نظام PDF يعمل بالكامل مع التوقيع الرقمي ورموز QR للتحقق، وإنشاء تلقائي للإيصالات. تحسين تصميم الإيصال الحراري ليتضمن أرقام الحسابات والتفاصيل الأساسية.
- **نظام البحث المتقدم**: دعم البحث الذكي في كشوفات الحساب مع تمييز النتائج ودعم البحث الجزئي والمطابقة غير الحساسة للأحرف.
- **مراقبة الرسائل**: صفحة مراقبة شاملة للرسائل مع بحث متقدم، إحصائيات فورية، وأزرار تصدير البيانات.
- **السوق المباشر للتداول**: منصة تداول مباشر مكتملة للعملات تشمل عروض البيع/الشراء، إحصائيات فورية، ودردشة مباشرة مع تحديث تلقائي للبيانات.
- **نظام إدارة عمولات المكاتب**: واجهة متكاملة لإدارة شرائح العمولة حسب المدن والمبالغ، مع دعم العمولة الثابتة والنسبة في الألف، مدمجة في صفحة الحوالات بين المدن.

### System Design Choices
- استخدام Socket.IO للتواصل الفوري في نظام المحادثات.
- تخزين الملفات المرفقة في `/public/uploads`.
- استخدام استعلامات SQL مباشرة للعمليات الحرجة.
- تتبع حالة الرسائل باستخدام جدول `message_reads`.
- تحويل البيانات بين snake_case (الخادم) و camelCase (العميل).
- نظام إشعارات متقدم للمسؤولين والنظام.

## External Dependencies
- **التقنيات الأساسية**:
    - TypeScript
    - WebSocket (عبر Socket.IO)
    - PostgreSQL (مع Drizzle ORM)
    - React
    - Tailwind CSS
    - shadcn/ui
- **بيئة التشغيل**: Node.js